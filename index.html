<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>PolyglotPal â€“ Instant Text Translator</title>
  <style>
    :root {
      --bg: #f4f4f4; --fg: #333; --card: #fff;
      --primary: #0066cc; --accent: #28a745; --border: #ccc;
    }
    [data-theme="dark"] {
      --bg: #1e1e1e; --fg: #eee; --card: #2c2c2c;
      --primary: #339af0; --accent: #5cb85c; --border: #555;
    }
    * { box-sizing:border-box; margin:0; padding:0; }
    body { background:var(--bg); color:var(--fg); font-family:Arial,sans-serif;
           display:flex; flex-direction:column; min-height:100vh; }
    header, footer { background:var(--primary); color:#fff; text-align:center; padding:1rem }
    main { flex:1; max-width:900px; margin:1rem auto; padding:1rem }
    .row { display:flex; flex-wrap:wrap; gap:.5rem; margin-bottom:1rem }
    select, button, textarea {
      font-size:1rem; border:1px solid var(--border); border-radius:4px;
      padding:.5rem; background:var(--card); color:var(--fg);
    }
    select, textarea { flex:1 }
    button { cursor:pointer; background:var(--accent); color:#fff; border:none; transition:background .2s; }
    button:hover { background:#1e7e34 }
    .swap-btn { background:var(--primary) }
    textarea { width:100%; min-height:100px; resize:vertical }
    .actions { display:flex; gap:.5rem; flex-wrap:wrap; margin-top:.5rem }
    .section { background:var(--card); border:1px solid var(--border);
               border-radius:6px; padding:1rem; margin-bottom:1rem }
    ul { list-style:none; padding:0; margin:0 }
    li { padding:.4rem; border-bottom:1px solid var(--border);
         display:flex; justify-content:space-between; align-items:center }
    li:last-child { border-bottom:none }
    .hist-text { flex:1; cursor:pointer }
    .star-btn { background:transparent; color:var(--accent); font-size:1.1rem }
  </style>
</head>
<body data-theme="light">
  <header>
    <h1>PolyglotPal</h1>
    <p>Translate text instantly, then click Speak ğŸ™ï¸</p>
  </header>

  <main>
    <div class="section">
      <div class="row">
        <select id="srcLang"></select>
        <button id="swapBtn" class="swap-btn">â†”ï¸ Swap</button>
        <select id="tgtLang"></select>
      </div>
      <div class="row">
        <textarea id="srcText" placeholder="Type textâ€¦"></textarea>
      </div>
      <div class="row">
        <button id="transBtn">Translate</button>
      </div>
      <div class="row">
        <textarea id="tgtText" readonly placeholder="Translationâ€¦"></textarea>
      </div>
      <div class="actions">
        <button id="speakBtn">ğŸ”Š Speak</button>
        <button id="copyBtn">ğŸ“‹ Copy</button>
        <button id="downloadBtn">â¬‡ï¸ Download</button>
        <button id="favBtn" class="star-btn">â˜† Favorite</button>
        <button id="themeBtn">ğŸŒ™ Dark Mode</button>
      </div>
    </div>

    <div class="section">
      <h2>History</h2>
      <ul id="historyList"></ul>
    </div>
    <div class="section">
      <h2>Favorites</h2>
      <ul id="favList"></ul>
    </div>
  </main>

  <footer>
    Â© 2025 Bocaletto Luca
  </footer>

  <script>
  (function(){
    const API_URL = 'https://api.mymemory.translated.net/get';
    const LANGS = { en:'English', es:'Spanish', fr:'French', de:'German', it:'Italian', 
      pt:'Portuguese', ru:'Russian', ja:'Japanese', zh:'Chinese', ar:'Arabic',
      ko:'Korean', nl:'Dutch', sv:'Swedish', hi:'Hindi', vi:'Vietnamese',
      id:'Indonesian', tr:'Turkish'
    };

    // UI refs
    const srcSel = document.getElementById('srcLang'),
          tgtSel = document.getElementById('tgtLang'),
          srcTa  = document.getElementById('srcText'),
          tgtTa  = document.getElementById('tgtText'),
          swapBtn= document.getElementById('swapBtn'),
          transBtn = document.getElementById('transBtn'),
          speakBtn = document.getElementById('speakBtn'),
          copyBtn  = document.getElementById('copyBtn'),
          downBtn  = document.getElementById('downloadBtn'),
          favBtn   = document.getElementById('favBtn'),
          themeBtn = document.getElementById('themeBtn'),
          histUL   = document.getElementById('historyList'),
          favUL    = document.getElementById('favList'),
          body     = document.body;

    let state = JSON.parse(localStorage.getItem('polyglotpal')||'{"history":[],"favorites":[]}');
    const saveState = ()=> localStorage.setItem('polyglotpal', JSON.stringify(state));

    // populate languages
    Object.entries(LANGS).forEach(([c,n])=>{
      srcSel.add(new Option(n,c));
      tgtSel.add(new Option(n,c));
    });
    srcSel.value='en'; tgtSel.value='es';

    // swap
    swapBtn.onclick = ()=>{
      [srcSel.value,tgtSel.value]=[tgtSel.value,srcSel.value];
      [srcTa.value,tgtTa.value]=[tgtTa.value,srcTa.value];
    };

    // translate
    transBtn.onclick = async ()=>{
      const q = srcTa.value.trim();
      if(!q) return;
      transBtn.disabled=true; tgtTa.value='â€¦Translating';
      try{
        const url = `${API_URL}?q=${encodeURIComponent(q)}&langpair=${srcSel.value}|${tgtSel.value}`;
        const res = await fetch(url);
        const json = await res.json();
        tgtTa.value = json.responseData.translatedText;
        addHistory(q,json.responseData.translatedText);
      } catch(e){
        console.error(e);
        tgtTa.value='Translation error';
      }
      transBtn.disabled=false;
    };

    // history & favorites
    function addHistory(s,t){
      const e={src:s,tgt:t,s:srcSel.value,t:tgtSel.value,ts:Date.now()};
      state.history.unshift(e);
      if(state.history.length>50) state.history.pop();
      saveState(); renderHistory();
    }
    function isFav(e){return state.favorites.some(f=>f.ts===e.ts);}
    function toggleFav(e){ 
      if(isFav(e)) state.favorites=state.favorites.filter(f=>f.ts!==e.ts);
      else state.favorites.unshift(e);
      saveState();
    }
    function renderHistory(){
      histUL.innerHTML='';
      state.history.forEach(e=>{
        const li=document.createElement('li');
        li.innerHTML=`<span class="hist-text">${e.src} â†’ ${e.tgt}</span>
                      <button class="star-btn">${isFav(e)?'â˜…':'â˜†'}</button>`;
        li.querySelector('.hist-text').onclick=()=>{
          srcTa.value=e.src; tgtTa.value=e.tgt;
          srcSel.value=e.s;  tgtSel.value=e.t;
        };
        li.querySelector('.star-btn').onclick=()=>{
          toggleFav(e); renderHistory(); renderFavorites();
        };
        histUL.append(li);
      });
    }
    function renderFavorites(){
      favUL.innerHTML='';
      state.favorites.forEach(e=>{
        const li=document.createElement('li');
        li.innerHTML=`<span class="hist-text">${e.src} â†’ ${e.tgt}</span>
                      <button class="star-btn">â˜…</button>`;
        li.querySelector('.hist-text').onclick=()=>{
          srcTa.value=e.src; tgtTa.value=e.tgt;
          srcSel.value=e.s;  tgtSel.value=e.t;
        };
        li.querySelector('.star-btn').onclick=()=>{
          toggleFav(e); renderHistory(); renderFavorites();
        };
        favUL.append(li);
      });
    }

    // speech synthesis
    let voices=[];
    function loadVoices(){ voices=speechSynthesis.getVoices(); console.log('Voices loaded',voices); }
    speechSynthesis.onvoiceschanged = loadVoices;
    loadVoices();

    speakBtn.onclick = ()=>{
      const txt = tgtTa.value.trim();
      if(!txt) return alert('Nothing to speak');
      if(speechSynthesis.speaking) speechSynthesis.cancel();
      const u=new SpeechSynthesisUtterance(txt);
      u.lang=tgtSel.value;
      const v=voices.find(v=>v.lang.toLowerCase().startsWith(tgtSel.value));
      if(v) u.voice=v;
      speechSynthesis.speak(u);
    };

    // copy/download/fav/theme
    copyBtn.onclick=async()=>{
      try{ await navigator.clipboard.writeText(tgtTa.value); alert('Copied'); }
      catch{ alert('Copy failed'); }
    };
    downBtn.onclick=()=>{
      const blob=new Blob([`Original (${srcSel.value}):\n${srcTa.value}\n\nTranslated (${tgtSel.value}):\n${tgtTa.value}`],
                          {type:'text/plain'});
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a');
      a.href=url; a.download='translation.txt'; a.click();
      URL.revokeObjectURL(url);
    };
    favBtn.onclick=()=>{
      const e={src:srcTa.value,tgt:tgtTa.value,s:srcSel.value,t:tgtSel.value,ts:Date.now()};
      toggleFav(e); renderHistory(); renderFavorites();
    };
    themeBtn.onclick=()=>{
      const t=body.dataset.theme==='light'?'dark':'light';
      body.dataset.theme=t;
      themeBtn.textContent=t==='dark'?'â˜€ï¸ Light Mode':'ğŸŒ™ Dark Mode';
    };

    // enter to translate
    srcTa.addEventListener('keydown',e=>{
      if(e.key==='Enter'&&!e.shiftKey){ e.preventDefault(); transBtn.click(); }
    });

    // init UI
    renderHistory(); renderFavorites();
  })();
  </script>
</body>
</html>
